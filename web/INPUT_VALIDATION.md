# 七星灯续命 - 用户输入有效性验证规则

## 📋 测试账号

| 手机号 | 昵称 | 密码 |
|--------|------|------|
| 13800000001 | 清风道人 | 123456 |
| 13800000002 | 明月居士 | 123456 |
| 13800000003 | 紫云仙子 | 123456 |
| 13800000004 | 青松隐士 | 123456 |
| 13800000005 | 白鹤真人 | 123456 |
| 13800000006 | 玄武道长 | 123456 |
| 13800000007 | 朱雀仙姑 | 123456 |
| 13800000008 | 青龙居士 | 123456 |
| 13800000009 | 白虎道人 | 123456 |
| 13800000010 | 麒麟真君 | 123456 |

**所有密码：`123456`**

---

## 🔍 输入有效性验证规则

### 1. 文本输入验证

#### 1.1 基础验证（前端）
- 非空检查：回答不能为空
- 长度限制：最少 2 字，最多 500 字
- 敏感词过滤：屏蔽不当内容

#### 1.2 AI 语义验证（后端）
AI 会判断回答是否包含有效健康信息：

| 有效回答示例 | 无效回答示例 |
|-------------|-------------|
| "今天走了8000步" | "还行" |
| "昨晚睡了7小时" | "一般般" |
| "吃了两碗米饭和青菜" | "不知道" |
| "心情很好，没有压力" | "嗯" |
| "血压120/80" | "随便" |

#### 1.3 验证结果处理
```json
{
  "valid": true,           // 是否有效
  "score": 8,              // 健康评分 1-10
  "value_extracted": "8000步",  // 提取的数值
  "reply": "善哉！日行八千，气血通畅。"  // AI 回复
}
```

### 2. 语音输入验证

#### 2.1 语音转文字
- 使用 Web Speech API 或第三方 ASR
- 转换后按文本规则验证

#### 2.2 语音质量检查
- 时长：最短 1 秒，最长 60 秒
- 音量：检测是否有有效音频
- 噪音：过滤纯噪音录音

---

## 📊 七星灯维度与指标分组

### 维度结构（7维度 × 7子项 = 49盏灯）

| 维度ID | 维度名 | 标签 | 子项指标 |
|--------|--------|------|----------|
| 1 | 天枢 | 命火 | 打卡连续性（1-7天对应1-7盏灯） |
| 2 | 天璇 | 谷神 | A.碳水 B.蔬菜 C.蛋白 D.油盐 E.饮水 F.节律 G.节制 |
| 3 | 天玑 | 动静 | A.步数 B.有氧 C.力量 D.久坐 E.拉伸 F.体态 G.户外 |
| 4 | 天权 | 归根 | A.入睡 B.时长 C.效率 D.连续 E.醒感 F.仪式 G.午休 |
| 5 | 玉衡 | 调息 | A.稳定 B.压力 C.专注 D.社交 E.愉悦 F.冥想 G.断联 |
| 6 | 开阳 | 营卫 | A.排便 B.皮肤 C.疼痛 D.体温 E.眼疲 F.呼吸 G.体征 |
| 7 | 摇光 | 固表 | A.蓝光 B.空气 C.天气 D.屏休 E.噪音 F.日照 G.湿度 |

### 分组说明

每个维度下有 **7个子项指标**（用字母 A-G 表示）：
- **横向**：同一维度的不同指标（如天璇的 A碳水、B蔬菜、C蛋白...）
- **纵向**：同一指标在不同时间的记录

### 重复测量设计

每个指标建议 **每日记录 1-3 次**：
- 早：晨起状态
- 中：日间活动
- 晚：睡前总结

---

## 🎯 评分标准

### 通用评分规则（1-10分）

| 分数 | 等级 | 灯状态 | 亮度 |
|------|------|--------|------|
| 9-10 | 优秀 | 亮 | 3（最亮） |
| 7-8 | 良好 | 亮 | 2 |
| 5-6 | 一般 | 亮 | 1（微亮） |
| 1-4 | 较差 | 灭 | 0 |

### 各维度具体评分标准

#### 天璇（谷神）- 饮食
| 指标 | 10分 | 7分 | 4分 | 1分 |
|------|------|-----|-----|-----|
| 碳水 | 适量全谷物 | 适量精制 | 过多/过少 | 极端 |
| 蔬菜 | ≥500g | 300-500g | 100-300g | <100g |
| 蛋白 | 优质蛋白适量 | 基本达标 | 不足/过量 | 严重失衡 |
| 饮水 | 2000ml+ | 1500-2000ml | 1000-1500ml | <1000ml |

#### 天玑（动静）- 运动
| 指标 | 10分 | 7分 | 4分 | 1分 |
|------|------|-----|-----|-----|
| 步数 | ≥10000 | 7000-10000 | 4000-7000 | <4000 |
| 有氧 | 30min+ | 20-30min | 10-20min | <10min |
| 久坐 | 每小时活动 | 2小时活动 | 3小时活动 | 久坐不动 |

#### 天权（归根）- 睡眠
| 指标 | 10分 | 7分 | 4分 | 1分 |
|------|------|-----|-----|-----|
| 入睡 | 22:00前 | 23:00前 | 24:00前 | 24:00后 |
| 时长 | 7-8小时 | 6-7小时 | 5-6小时 | <5小时 |
| 醒感 | 精神饱满 | 较好 | 一般 | 疲惫 |

---

## 🔄 处理流程

```
用户输入 → 前端验证 → 后端接收 → AI解析 → 有效性判断 → 更新灯状态
    ↓           ↓           ↓          ↓           ↓
  空值检查   长度检查    幂等检查   语义分析   score>0 → 亮灯
                                              score=0 → 提示重答
```

---

## 📝 API 调用示例

### 提交打卡答案
```bash
curl -X POST http://localhost:3002/api/checkin/answer \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "questionId": "q_001",
    "question": "今天有没有吃精制糖过多的食物？",
    "answerText": "今天喝了一杯奶茶，其他没有吃甜食",
    "dimensionId": 2,
    "subItemId": 7
  }'
```

### 响应示例
```json
{
  "success": true,
  "data": {
    "valid": true,
    "reply": "一杯奶茶尚可，切记节制为上。",
    "dimensionId": 2,
    "subItemId": 7,
    "metricName": "节制",
    "score": 6
  }
}
```

---

## ⚠️ 无效输入处理

当输入被判定为无效时：
1. 不更新灯状态
2. 返回引导性回复
3. 允许用户重新作答

无效回复示例：
- "天机混沌，请施主明示。"
- "此言难解，可否详述？"
- "道法自然，请具体描述。"
