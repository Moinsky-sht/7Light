<title></title><style></style>

##**续命APP：**

### **一、定位**

以“七星灯续命”为趣味核心，将健康管理转化为“点亮灯盏、延续时长”的沉浸式体验。通过轻量化打卡、个性化健康建议、自定义内容补充，让用户在趣味互动中养成健康习惯，同时沉淀个人健康语料库，实现“趣味驱动+数据沉淀”的双重价值。每天会有AI根据个人情况随机生成问题，用户回答问题，就有可能点亮其中的一个灯。

核心Slogan：点亮七星灯，日日续长生

### **二、个人信息体系**

**1.必填信息**

- 基础身份信息：性别（男/女）、出生日期（自动换算年龄，避免手动输入误差）；

- 基础身体数据：身高（cm）、体重（kg）（自动计算BMI，展示在个人主页）；

- 账号安全信息：手机号/邮箱、验证码、密码（支持第三方快捷登录，登录后补全基础信息

**2. 选填信息（点亮“基础灯盏”解锁）**

- 健康基础：是否有慢性疾病（可选类别）、过敏史、日常作息模式（早睡早起/熬夜/轮班）；

- 健康目标：减脂/增肌/调理作息/改善睡眠/提升免疫力（可多选，APP据此推送对应问答和建议）；

- 生活习惯：饮食习惯（素食/肉食/均衡/重油重盐等）、运动频率（每日/每周2-3次/几乎不运动）、是否吸烟饮酒。
3. 信息管理规则

4.  个人信息仅用于生成个性化内容，支持随时在“我的-资料设置”中修改、补充；

5.  敏感健康信息（如慢性病、过敏史）加密存储，仅用户本人可见，不对外共享；

### 三、**核心功能模块**

导航栏：点灯、亮灯、灯友、我的

#### **导航1：点灯（tab1首页）**

核心视觉为一个古风灯盏，整体设计贴合“续命长生”的玄学趣味。这个灯每天默认是灭的，当天回答完不低于三个问题，则点亮它，三次逐步点亮。

- 核心数据展示：顶部突出显示累计续命时长（按天、断签不扣时长、不补卡）以一周为一个周期，刚好一天一个维度，随着用户画像逐步完善

当日健康题（根据用户健康目标、年龄性别个性化推送），题干简洁（如“今日饮水量是否达标？”“昨晚睡眠时长超过7小时了吗？”），支持文字⌨️/语音��快速回答，支持切换主动添加燃料（即主动添加个人健康信息）一旦满足维度的三条有效信息收集则视为点亮

-下边栏：四个导航

每输入一条信息，都会弹出处理的窗口，显示分类的维度和点亮的灯。如果产生更新，则在导航2亮灯界面加上一个“？”来表示有更新。

#### **导航2：亮灯（tab2）**

七盏大灯，每盏大灯有一个UI，点进去显示新页面即有7盏小灯，7盏小灯又是7个维度，具体维度的定义在下文。

七盏大灯有7个亮度，点亮其中一个小灯则有一个亮度。

七盏灯，第一盏灯灯的点亮与亮度需要tab1的坚持。第一个维度的七盏灯代表连续七天的打卡，如果连续有7天，则点亮7盏灯，如果有断，则灭掉一盏灯。

其他六盏灯分为六个健康大维度，每盏灯点击可做跳转子页面交互，如第一站灯进去出现新的七盏灯（代表打卡天数）  

| 主星  | 宏观维度    | 核心量化方向 (7 颗小灯)              |
| --- | ------- | --------------------------- |
| 天枢  | 命火 (打卡) | 连续打卡 1-7 天的生命延续记录           |
| 天璇  | 谷神 (饮食) | 碳水、蔬果、蛋白、控油盐、水分、节律、知止度      |
| 天玑  | 动静 (运动) | 步数、心肺、肌力、破久坐、拉伸、姿态、户外       |
| 天权  | 归根 (睡眠) | 入睡时间、时长、效率、连续性、醒后感、仪式感、午憩   |
| 玉衡  | 调息 (心理) | 稳定度、压力感、专注度、社交、愉悦感、冥想、念头截断  |
| 开阳  | 营卫 (体征) | 排泄、皮肤、痛感、体温感、视力疲劳、呼吸、基础指标   |
| 摇光  | 固表 (环境) | 光磁调节、清气、节气顺应、离屏时间、噪音、光合、温湿感 |

一、 【天璇星】· 谷神维度（饮食营养）

宏观定义：能量摄入的质与量。

碳水适量：是否摄入优质碳水（杂粮/薯类），无过量精制糖。

蔬果足量：每日摄入至少3-5种蔬菜或水果。

蛋白优选：摄入鱼肉蛋奶或豆类蛋白，避免深加工肉类。

控油控盐：饮食清淡，无重油重盐的外卖或零食。

水分充盈：饮水量是否达到 1500-2000ml。

进食节律：三餐时间是否固定，晚饭是否在睡前3小时完成。

知止度：是否达成“七分饱”，无暴饮暴食。

二、 【天玑星】· 动静维度（躯体活动）

宏观定义：气血循环与肌肉张力。

基础步数：是否达到 6000 步的基础活跃线。

心肺激活：是否有 20 分钟以上的中高强度运动（心率提升）。

肌力维持：是否有抗阻训练（俯卧撑、深蹲、举铁等）。

久坐破除：每小时是否有站立或走动。

筋骨拉伸：是否有 5 分钟以上的身体柔韧性拉伸。

姿态正位：今日是否有意识纠正圆肩驼背、二郎腿等。

环境接触：是否有户外活动，接触自然光照。

三、 【天权星】· 归根维度（睡眠修复）

宏观定义：神经系统的关机与自愈。

入睡时间：是否在 23:00（子时）前上床准备入睡。

总时长：睡眠是否达到 7-9 小时。

入睡潜伏期：是否能在 30 分钟内入睡（无失眠）。

睡眠连续性：半夜醒来次数是否少于 1 次。

晨起感受：醒后是否感到精力充沛，无头脑昏沉。

睡前仪式：睡前 1 小时是否远离电子屏幕。

午间小憩：中午是否有 15-30 分钟的能量恢复。

四、 【玉衡星】· 调息维度（情绪压力）

宏观定义：心理能量的平衡与损耗。

情绪稳定性：今日是否没有出现剧烈的情绪波动。

压力感知：主观感受到的压力是否在可控范围内。

专注时间：今日是否有超过 1 小时的深度专注状态。

社交补给：是否与亲友进行了有质量的正面交流。

精神愉悦：今日是否做了一件纯粹让自己开心的事。

冥想/留白：是否给自己留了 5 分钟以上的静坐或放空时间。

负面截断：是否成功从焦虑、抱怨等负面念头中抽离。

五、 【开阳星】· 营卫维度（身体指标）

宏观定义：免疫系统与代谢特征。

排泄顺畅：每日排便是否规律、形状色泽是否正常。

皮肤状态：是否有突发的冒痘、干裂、过敏或暗沉。

局部痛感：腰、颈、肩、头等关键部位是否有酸痛感。

体温感官：手脚是否温热，无异常怕冷或潮热。

视力疲劳：眼睛是否有干涩、胀痛或视物模糊。

呼吸通透：呼吸是否深长平稳，无鼻塞、气短。

基础体征：BMI、血压、心率是否处于个人正常区间（周期性录入）。

六、 【摇光星】· 固表维度（环境与防御）

宏观定义：个体与外部环境的能量交换及屏障保护。

光磁调节：睡前 1 小时是否减少蓝光接触（手机/电脑），是否有意识防范电磁辐射。

空气清气：所处环境空气是否流通，是否接触了二手烟、粉尘或油烟。

节气顺应：是否根据天气变化增减衣物（如：夏季避开空调直吹，冬季保护头足温热）。

感官休歇：今日是否有累计 1 小时以上的“离屏时间”（远离所有屏幕，让视觉神经休息）。

噪音防护：是否长期处于高分贝环境，是否有意识寻找安静空间进行听觉修复。

光合接触：今日是否接受了有效光照（阳光能合成维生素 D，调节生物钟）。

温湿度体感：所处空间（办公室/卧室）的温湿度是否让身体感到舒适，无明显燥热或寒湿。  

每个单独的灯点进去之后还会出现一个窗口，显示当前状态（即过往的语料的积累）、未来建议。

同时左上角可设置交互按钮给出总结性的健康报告（依据目前用户数据库完善最新），右上角加入最近三天的亮灯变化趋势，包含应有信息，适应页面大小。

#### **导航3：灯友（tab3）**

顶部搜索栏：搜索框：支持通过 用户 ID 精确查找并添加好友。

右上方1按钮：我的好友：好友列表入口。

右上方2按钮：互动消息：申请列表：好友申请信息。互动提醒：点赞、提醒打卡（借火）的通知。

1. 核心视觉：【众星之阵】

视觉呈现：进入该模块，不再是信息流，而是一个浩瀚的星空背景。每一位灯友都是星空中的一点星光（读取用户头像且发光）。三d交互类似于球体知识图谱，可手动拖拽滚动

星光亮度：根据灯友当天的打卡完整度，星光会有明暗变化。

2. 社交互动：【借火】与【护法】

借火（点赞替代）：当某位灯友连续打卡中断，灯火即将熄灭时，好友可以点击“借火”。这会给对方发送一个温暖的震动提醒，并短暂延长其“命火”的视觉燃烧时间，鼓励其上线打卡。

结缘（关注替代）：即加好友。

护法（评论替代）：即给别人留言。当你看到某人在星阵中更新了“今日体感寒凉”（星星旁边有类似感叹号等），你可以投递一张“姜茶卡片”或留言建议，这种互动被称为“法布施”。（可考虑）

3. 组队修行：【点灯祈福】

限时任务：例如“入冬点灯计划”，需要 某位灯友连续 某天共同达成【天璇（饮食）】维度的全绿。

奖励：成功后，每个人的主页背景会获得限时的“祥云”或“金光”特效，象征功德圆满  
绿。（可考虑,初步demo不加

#### **导航4：我的（tab4）**

1. 个人状态区 (Header)

基础信息：头像、昵称、唯一识别 ID (用于被搜添加)。

健康勋章：展示累计打卡天数、最高连续记录。

实时状态：当前健康评分（基于 7 维度数据综合计算）。

2. 健康管理 (Health Management)

健康月历：点击查看历史每日打卡详情及七星灯亮灭情况。

身体指标：查看身高、体重、BMI 的变化趋势图表。

语料归纳：个人打卡高频词统计（由语音/文字转换而来的个人标签）。

健康报告：周报、月报的生成与查看入口。

3. 系统配置 (System Settings)

个人资料修改：重新编辑性别、年龄、身高、体重等基础信息。

目标设置：自定义每日提醒打卡的时间。

数据绑定：第三方健康数据（Apple Health / 穿戴设备）同步管理。

隐私与权限：管理语料库加密、匿名共享权限。

4. 账号操作 (Account Operations)

清除缓存：释放应用占用空间。

反馈与建议：提交产品意见。

关于我们：版本号及用户协议。

切换账号 (Switch Account)：支持快速登录其他已存账号。

退出登录 (Log Out)：退出当前账号回到登录页。

### 四、**大模型调用**

全部文本生成大模型的调用信息建议通过「管理后台 → 系统设置 → AI 配置」维护，避免在文档中出现明文密钥。

如需本地调试，可参考：
- base url：https://aiping.cn/api/v1
- API key：请使用你自己的密钥（不要写入仓库）

具体模型ID使用：MiniMax-M2.1  
调用文档：https://aiping.cn/model?model_series=MiniMax-M2.1

from openai import OpenAI

openai_client = OpenAI(

    base_url="https://aiping.cn/api/v1",

    api_key="YOUR_API_KEY"

)

response = openai_client.chat.completions.create(

    model="MiniMax-M2.1",

    stream=True,

    extra_body={

        "provider": {

            "only": [],

            "order": [],

            "sort": None,

            "input_price_range": [],

            "output_price_range": [],

            "input_length_range": [],

            "output_length_range": [],

            "throughput_range": [],

            "latency_range": []

        }

    },

    messages=[

        {"role": "user", "content": "Hello"}

    ]

)

for chunk in response:

    if not getattr(chunk, "choices", None):

        continue

    reasoning_content = getattr(chunk.choices[0].delta, "reasoning_content", None)

    if reasoning_content:

        print(reasoning_content, end="", flush=True)

    content = getattr(chunk.choices[0].delta, "content", None)

    if content:

        print(content, end="", flush=True)

所有的大模型生成都请你设计好提示词，并且所有提示词可以管理。建立一个 Prompt 管理后台，针对 7 个维度分别调试解析成功率 。建立提示词管理后台 —— 按 “7 维度 49 子项” 分类预设提示词，标注版本及效果；新增校验逻辑，AI 生成问题 / 解析结果后，后端校验是否匹配对应子项，不匹配则驳回重生成。

1. 每日个性化提问生成

触发场景：用户进入“点灯”首页或点击切换问题。

输入数据：用户基本信息（性别、年龄、目标）、各维度历史评分、当前缺失最久的数据维度。

模型任务：根据当前最需要补充的健康维度，生成一个对应的趣味问句。

输出内容：短文本问题。

2. 打卡语料结构化解析

触发场景：用户提交文本或语音打卡回复后。

输入数据：用户回复的原始文本。

模型任务：识别回复中包含的健康要素，将其分类至七大维度，并判定正负向评分。

输出内容：标准 JSON 数据（含：维度ID、指标项、数值、量化结果）。

3. 健康预警逻辑判定

触发场景：后端接收到异常数值（如过低或过高）或负面体感描述时。

输入数据：打卡解析后的量化数据及用户的主观症状描述。

模型任务：判定该状况属于“正常”、“预警（橙色）”还是“危险（红色）”。

输出内容：灯盏颜色状态码、简短的风险分类。

4. 个人健康周/月报生成

触发场景：用户点击查看“我的-健康报告”。

输入数据：周期内所有打卡语料统计、49盏灯的明暗频率、BMI等数值变化趋势。

模型任务：归纳用户的健康高频词，总结周期内的健康表现，并提供下一阶段的建议。

输出内容：总结性文本、标签词云数据。

5. 个人健康标签提取（语料归纳）

触发场景：后端定期对用户历史语料进行聚类分析。

输入数据：用户近期的所有文本回答记录。

模型任务：提取用户的健康画像标签（如“久坐族”、“深夜活跃”、“饮食清淡”等）。

输出内容：关键词列表（用于“我的”页面展示）。

### **五、数据表结构**

**1. 用户基础信息表 (User_Profile)**

用途：存储用户静态信息与实时健康画像。

核心字段：UID、性别、出生日期、初始身高/体重、当前 BMI、健康目标（多选标签）、账户安全信息（加密后的手机号/密码）、第三方账号标识灯。

2. 七星灯状态主表 (Star_Lamp_Status)

用途：存储 49 盏灯（7 维度 × 7 子项）的实时状态。

核心字段：UID、维度 ID、子项 ID（1-7）、当前颜色值（红/橙/黄/灭）、亮度等级（1-3）、最后一次数据更新时间、累计点亮次数。可以优先实现亮灯，先不管颜色。

索引建议：UID + 维度 ID 复合索引，用于快速渲染“亮灯”页面。

3. 健康语料记录表 (Health_Corpus_Log)

用途：存储用户所有的打卡记录，作为 AI 提取数据的源头。

核心字段：UID、打卡时间、输入类型（文本/语音转义文本）、原始语料内容、AI 解析后的结构化 JSON 镜像（记录当时提取的数值）、关联的维度 ID。

4. 动态打卡统计表 (Checkin_Statistics)

用途：用于计算“续命时长”和连续打卡逻辑。

核心字段：UID、累计打卡总天数、当前连续打卡天数、最高连续纪录、累计获得的“续命总时长”（秒/分单位）。

5. 社交关系与动态表 (Social_Connection)

用途：支撑“灯友”星阵与互动。

核心字段：UID、好友 UID（灯友关系）、关系状态（申请中/已结缘/拉黑）、结缘时间、最后互动力度（用于星阵权重排名）。

6. 社交互动日志表 (Social_Interaction_Log)

用途：记录“借火”、“护法”等行为。

核心字段：发起者 UID、接收者 UID、互动类型（借火/法布施）、交互文案（由 LLM 生成的内容镜像）、是否已读。

7. 健康报告归档表 (Health_Report_Archive)

用途：存储 AI 生成的周报/月报总结。

核心字段：UID、报告周期（开始/结束日期）、AI 总结全文、建议关键词、生成时的 7 维度平均分快照。

### **六、****API设置**

为了确保产品能快速跑通核心链路（MVP版本），同时保留“续命”的完整世界观，我将上述 API 和功能拆分为两个阶段：第一阶段（核心闭环）和第二阶段（体验优化）。

第一阶段：必须尽快做出来的（核心命脉）

这一部分决定了用户能不能“点亮第一盏灯”，是 Demo 的骨架。

1. 基础账户与初始化

API: auth/login (登录), user/init (基础信息补全)。

理由: 没有用户信息（性别、身高、体重），后端无法计算 BMI，AI 无法生成个性化问题。

2. AI 核心打卡链路（核心中的核心）

API: checkin/question (取题), checkin/answer (回答并解析)。

理由: 这是“续命”逻辑的起点。必须实现：用户说话 -> LLM 提取数值 -> 存入数据库 -> 灯亮 这一完整闭环。

核心逻辑: 哪怕只先做一个“天枢星”维度，也要把 AI 解析 JSON 的稳定性跑通。

3. 灯阵状态渲染

API: lamps/full-grid (49盏灯状态)。

理由: 这是 Tab 2 的核心视觉。如果灯阵不能根据打卡结果实时改变颜色和亮度，用户就没有反馈感。

4. 简易统计与时长计算

API: user/home (首页概览), checkin/status (今日打卡进度)。

理由: 必须让用户看到“累计续命时长”在增加，这是产品最核心的数值激励。

第二阶段：可以先 Demo 或延后完善的（血肉填充）

这些功能在 Demo 演示时可以先用模拟数据，或者放在第二步开发。

1. 社交互动模块（星空社交）

API: social/starfield (星阵), social/interaction/boost (借火)。

状态: Demo 级。

处理方案: 演示时可以先随机生成一些虚拟的“星光”在屏幕上滚动，不一定要实现真实的、高并发的实时交互。

2. 深度分析与报告

API: lamps/report/generate (健康报告), manage/trends (趋势图)。

状态: 延后。

处理方案: 第一阶段只需要灯亮。周报和月报需要至少 7 天的数据沉淀，前期可以用固定的模板替代 AI 生成。

3. 数据同步与安全

API: manage/sync (三方数据同步), manage/cache (清理缓存)。

状态: 延后。

处理方案: Demo 期手动输入即可，不需要接入 Apple Health 或处理复杂的隐私解密逻辑。

4. 语料归纳与标签

API: manage/tags (个人标签)。

状态: 延后。

处理方案: 这是一个长期沉淀功能，初期用户回复太少，算不出来的标签。

### 七、**其他注意细节**

**异步处理机制 (Async Queue)**：打卡接口必须设计为异步。后端接收语料后存入队列并立即向前端返回“处理中”状态，解析完成后通过 **WebSocket 或推送**点亮灯盏，防止 AI 响应慢导致 App 卡死 。

**幂等性要求 (Idempotency)**：打卡请求必须携带唯一 request_id（UUID），后端需校验该 ID，防止用户快速重复点击或网络重试导致“续命时长”重复增加 。

**提问权重算法**：增加“权重随机”逻辑，优先生成针对“状态最暗/数据最久未更新”维度的问题 。

**事务一致性要求 (Atomic Transaction)**：AI 解析语料并更新 Star_Lamp_Status 表时，必须与 Health_Corpus_Log 表的写入操作放在同一个**数据库事务**中，确保打卡记录与灯盏状态始终同步 。

**缓存同步要求**：49 盏灯的实时状态需同步至 **Redis 缓存**，确保 Tab 2 页面及“众星之阵”高频加载时的响应速度，避免频繁扫描 SQL 表 。

**Prompt 强约束规范**：所有提示词必须包含 Format: JSON Only 指令，并定义严格的 **JSON Schema**。后端解析代码必须增加容错逻辑，处理 AI 可能返回的非标准格式 。

**时长计算逻辑**：续命时长的增加必须由后端根据打卡逻辑自动计算，严禁接受前端直接传参修改时长数值，防止通过抓包修改数据实现“无限续命” 。

新增解析容错机制：模糊回答触发 AI 追问（如 “你说的‘还行’是指饮水量达到 1500ml 了吗？”），方言转写误差提示用户手动修正；

无效回答直接提示 “未检测到健康信息，请补充具体状态”，且不计入当日 3 题计数，避免用户白忙活。
