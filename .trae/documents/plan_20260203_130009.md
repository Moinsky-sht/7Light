# 彻底移除模拟数据与生产环境就绪计划

根据您的要求，我将清理所有“演示用”的模拟数据，并完善数据库和安全机制，使项目达到生产可用标准。

## 1. 数据库与权限系统升级 (Database & Auth)
目前数据库缺少管理员权限控制，用户表结构过于简单。

- **Schema 升级**: 在 `users` 表中添加 `role` 字段 (admin/user)。
- **JWT 增强**: 更新 Token 生成逻辑，将 `role` 写入 JWT Payload。
- **中间件**: 创建 `server/middleware/admin.ts`，拦截 `/api/admin` 开头的请求，强制校验管理员权限。
- **注意**: 修改 Schema 后，现有的 `sevenstar.db` 可能不兼容。由于是开发环境，我建议直接删除旧数据库文件，让系统自动重建新的表结构。

## 2. 移除所有模拟数据 (Remove Mock Data)
彻底删除代码中的硬编码数据和“假装成功”的逻辑。

- **排行榜**: 修改 `api/social/leaderboard.get.ts`，删除 `THREE_KINGDOM_CHARS` 数组和 `?mock=true` 逻辑，仅返回数据库真实数据。
- **打卡历史**: 修改 `api/checkin/history.get.ts`，删除“无数据时返回 5 条模拟记录”的逻辑，无数据即返回空数组。
- **语音识别**: 重构 `api/speech/recognize.post.ts`，删除硬编码的 API Key 和模拟返回逻辑。如果 API 调用失败，直接返回真实错误信息。
- **AI 服务**: 检查 `services/ai.ts`，移除所有默认的“兜底回复”（如“此灯光芒初现...”），确保内容完全由 AI 生成或明确提示服务不可用。

## 3. 环境变量与配置 (Configuration)
将敏感信息移出代码库。

- **创建 .env**: 配置 `DASHSCOPE_API_KEY` (阿里云)、`JWT_SECRET` 等关键变量。
- **配置读取**: 修改代码使用 `process.env` 或 `useRuntimeConfig` 读取配置。

## 4. 执行步骤
1.  **配置**: 创建 `.env` 文件。
2.  **数据库**: 修改 `schema.ts` 添加 `role` 字段。
3.  **核心代码**: 修正 `jwt.ts` 和 `auth` 接口。
4.  **清理**: 逐个清理 `speech`, `leaderboard`, `history` 接口中的 Mock 代码。
5.  **安全**: 为 Admin 接口添加权限校验。
