# 重构“我的”页面与修复登录功能计划

我将分两步执行此计划：首先修复登录 API 的 500 错误并完善数据库结构，然后重构“我的”页面布局并开发新的“健康通知”功能。

## 1. 后端修复与数据库升级
### 数据库架构更新
- **Schema 升级**: 在 `user_profiles` 表中新增 `notification_settings` 字段，用于存储健康通知偏好。
- **自动迁移逻辑**: 修改 `web/server/db/index.ts` 中的 `initDatabase` 函数，增加自动检查并添加缺失列（如 `occupation` 和 `notification_settings`）的逻辑，确保现有数据库不会因为缺少字段而导致 API 报错。

### API 修复与增强
- **修复登录接口**: 优化 `web/server/api/auth/login.post.ts`，增加详细的错误日志捕获，确保 `bcrypt` 密码验证的健壮性。
- **更新用户信息接口**:
    - 修改 `web/server/api/auth/me.get.ts` 以返回新增的 `notificationSettings`。
    - 修改 `web/server/api/user/profile.post.ts` 以支持更新 `notificationSettings`。

## 2. 前端页面重构 (`profile.vue`)
### 模块化重组
将功能菜单重新划分为三大模块：
1.  **基础信息**:
    - 个人信息 (原有)
    - **健康通知 (新功能)**: 点击弹出设置面板。
    - 健康偏好 (原有)
    - 会员订阅 (原有)
    - 隐私偏好 (原“隐私设置”)
2.  **我的数据**:
    - 打卡记录 (原有)
    - 健康成就 (原“成就徽章”)
    - 健康报告 (原有)
3.  **其他设置**:
    - 系统设置 (原“设置”)
    - 意见反馈 (原有)
    - 关于我们 (原有)

### 新增“健康通知”功能
- 开发 `HealthNotificationModal` 组件（弹窗形式），包含以下开关：
    - **签到提醒**: 全局开关。
    - **七大维度推送**: 天枢(命火)、天璇(谷神)、天玑(动静)、天权(归根)、玉衡(调息)、开阳(营卫)、摇光(固表) 的独立通知开关。
- 实现数据与后端 `user_profiles.notification_settings` 的双向绑定。

## 3. 验证
- 验证登录功能是否恢复正常。
- 检查“我的”页面布局是否符合新的分类要求。
- 测试“健康通知”设置的保存与读取。
- 确认“健康成就”、“隐私偏好”等更名是否生效。
